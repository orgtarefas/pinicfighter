<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pinico Fighter</title>

<style>
body {
    margin: 0;
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial, sans-serif;
}

#game {
    position: relative;
    width: 900px;
    height: 500px;
    background: #444;
    border: 4px solid #000;
}

#logo {
    position: absolute;
    top: 5px;
    left: 50%;
    transform: translateX(-50%);
    height: 60px;
    z-index: 3;
}

canvas {
    background: #aaa;
}

#msg {
    position: absolute;
    top: 45%;
    width: 100%;
    text-align: center;
    font-size: 32px;
    color: white;
    display: none;
    z-index: 5;
}

#reset {
    position: absolute;
    top: 55%;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 20px;
    font-size: 18px;
    display: none;
    z-index: 5;
}
</style>
</head>

<body>

<div id="game">
    <img id="logo" src="imagens/logo.png">
    <canvas id="canvas" width="900" height="500"></canvas>
    <div id="msg"></div>
    <button id="reset">Recomeçar</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
    apiKey: "AIzaSyDy_gqNrFR7KmMonXp7KfgRc15UVj0g3Nw",
    authDomain: "pinico-fighter.firebaseapp.com",
    databaseURL: "https://pinico-fighter-default-rtdb.firebaseio.com",
    projectId: "pinico-fighter",
    storageBucket: "pinico-fighter.firebasestorage.app",
    messagingSenderId: "152199667347",
    appId: "1:152199667347:web:9c74188c88bdee8633f766"
});

const db = firebase.database();
</script>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const fundo = new Image();
fundo.src = "imagens/fundo.png";

const msg = document.getElementById("msg");
const resetBtn = document.getElementById("reset");

const chao = 380;
const gravidade = 0.8;

class Lutador {
    constructor(x, cor) {
        this.x = x;
        this.y = chao;
        this.vy = 0;
        this.cor = cor;
        this.vida = 100;
        this.dir = 1;
        this.atacando = false;
        this.vivo = true;
    }

    atacar(inimigo) {
        if (!this.vivo) return;
        this.atacando = true;
        setTimeout(() => this.atacando = false, 150);

        if (Math.abs(this.x - inimigo.x) < 60) {
            inimigo.vida -= 10;
            if (inimigo.vida <= 0) {
                inimigo.vida = 0;
                inimigo.vivo = false;
                fimDeJogo(this);
            }
        }
    }

    pular() {
        if (this.y === chao) this.vy = -15;
    }

    atualizar() {
        this.y += this.vy;
        this.vy += gravidade;
        if (this.y > chao) {
            this.y = chao;
            this.vy = 0;
        }
    }

    desenhar() {
        ctx.strokeStyle = this.cor;
        ctx.lineWidth = 4;

        if (!this.vivo) {
            ctx.beginPath();
            ctx.moveTo(this.x - 30, this.y);
            ctx.lineTo(this.x + 30, this.y);
            ctx.stroke();
            return;
        }

        const y = this.y - 60;

        // Corpo
        ctx.beginPath();
        ctx.moveTo(this.x, y);
        ctx.lineTo(this.x, this.y);
        ctx.stroke();

        // Cabeça
        ctx.beginPath();
        ctx.arc(this.x, y - 10, 10, 0, Math.PI * 2);
        ctx.stroke();

        // Braço ataque
        ctx.beginPath();
        ctx.moveTo(this.x, y + 20);
        ctx.lineTo(this.x + this.dir * (this.atacando ? 30 : 15), y + 30);
        ctx.stroke();

        // Outro braço
        ctx.beginPath();
        ctx.moveTo(this.x, y + 20);
        ctx.lineTo(this.x - this.dir * 10, y + 30);
        ctx.stroke();

        // Pernas
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - 10, this.y + 20);
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x + 10, this.y + 20);
        ctx.stroke();
    }
}

const p1 = new Lutador(250, "blue");
const p2 = new Lutador(650, "red");
p2.dir = -1;

function desenharVida(p, x) {
    ctx.fillStyle = "black";
    ctx.fillRect(x, 20, 200, 20);
    ctx.fillStyle = "lime";
    ctx.fillRect(x, 20, p.vida * 2, 20);
}

function fimDeJogo(vencedor) {
    msg.innerText = vencedor === p1 ? "Player 1 venceu!" : "Player 2 venceu!";
    msg.style.display = "block";
    resetBtn.style.display = "block";
}

resetBtn.onclick = () => location.reload();

document.addEventListener("keydown", e => {
    if (e.key === "a") p1.x -= 10;
    if (e.key === "d") p1.x += 10;
    if (e.key === "w") p1.pular();
    if (e.key === "f") p1.atacar(p2);

    if (e.key === "ArrowLeft") p2.x -= 10;
    if (e.key === "ArrowRight") p2.x += 10;
    if (e.key === "ArrowUp") p2.pular();
    if (e.key === "Enter") p2.atacar(p1);
});

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Fundo mais embaixo (nos pés)
    ctx.drawImage(fundo, 0, 300, canvas.width, 200);

    p1.atualizar();
    p2.atualizar();

    p1.desenhar();
    p2.desenhar();

    desenharVida(p1, 20);
    desenharVida(p2, 680);

    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
