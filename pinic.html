<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Jogo de Luta - Bonecos</title>

<style>
    body {
        margin: 0;
        background: #111;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: white;
        font-family: Arial;
    }

    canvas {
        border: 3px solid #0f0;
    }

    .logo {
        margin-bottom: 10px;
    }

    .logo img {
        max-width: 240px;
    }
</style>
</head>

<body>

<div class="logo">
    <img src="imagens/logo.png">
</div>

<canvas id="game" width="900" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const fundo = new Image();
fundo.src = "imagens/fundo.png";

const GRAVIDADE = 0.8;
const CHAO = 320;
const LIMITE_ESQ = 40;
const LIMITE_DIR = canvas.width - 40;

class Lutador {
    constructor(x, cor, controles, direcao) {
        this.inicialX = x;
        this.x = x;
        this.y = CHAO;
        this.vy = 0;
        this.cor = cor;
        this.altura = 60;
        this.pulando = false;
        this.velocidade = 4;
        this.direcao = direcao;
        this.atacando = false;
        this.tempoAtaque = 0;
        this.vida = 100;
        this.vivo = true;
        this.controles = controles;
    }

    mover(keys) {
        if (!this.vivo) return;
        if (keys[this.controles.esq]) {
            this.x -= this.velocidade;
            this.direcao = -1;
        }
        if (keys[this.controles.dir]) {
            this.x += this.velocidade;
            this.direcao = 1;
        }
        if (this.x < LIMITE_ESQ) this.x = LIMITE_ESQ;
        if (this.x > LIMITE_DIR) this.x = LIMITE_DIR;
    }

    pular(keys) {
        if (!this.vivo) return;
        if (keys[this.controles.pulo] && !this.pulando) {
            this.vy = -15;
            this.pulando = true;
        }
    }

    atacar(keys, inimigo) {
        if (!this.vivo) return;
        if (keys[this.controles.ataque] && !this.atacando) {
            this.atacando = true;
            this.tempoAtaque = 10;
            const hitbox = {
                x: this.x + (this.direcao * 25),
                y: this.y - this.altura + 20,
                w: 25,
                h: 20
            };
            if (colisao(hitbox, inimigo.getHitbox())) {
                inimigo.receberDano(10);
            }
        }
        if (this.atacando) {
            this.tempoAtaque--;
            if (this.tempoAtaque <= 0) this.atacando = false;
        }
    }

    receberDano(valor) {
        this.vida -= valor;
        if (this.vida <= 0) {
            this.vida = 0;
            this.vivo = false;
        }
    }

    aplicarFisica() {
        if (!this.vivo) {
            this.y = CHAO + 20;
            return;
        }
        this.y += this.vy;
        this.vy += GRAVIDADE;
        if (this.y >= CHAO) {
            this.y = CHAO;
            this.vy = 0;
            this.pulando = false;
        }
    }

    getHitbox() {
        return {
            x: this.x - 10,
            y: this.y - this.altura - 10,
            w: 20,
            h: this.altura + 20
        };
    }

    desenhar() {
        ctx.strokeStyle = this.cor;
        ctx.lineWidth = 4;

        if (!this.vivo) {
            ctx.beginPath();
            ctx.moveTo(this.x - 30, this.y);
            ctx.lineTo(this.x + 30, this.y);
            ctx.stroke();
            return;
        }

        const corpoY = this.y - this.altura;

        ctx.beginPath();
        ctx.moveTo(this.x, corpoY);
        ctx.lineTo(this.x, this.y);
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(this.x, corpoY - 10, 10, 0, Math.PI * 2);
        ctx.stroke();

        let bracoX = this.x + (this.direcao * (this.atacando ? 30 : 15));
        ctx.beginPath();
        ctx.moveTo(this.x, corpoY + 20);
        ctx.lineTo(bracoX, corpoY + 30);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(this.x, corpoY + 20);
        ctx.lineTo(this.x - (this.direcao * 10), corpoY + 30);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - 10, this.y + 20);
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x + 10, this.y + 20);
        ctx.stroke();
    }

    reset() {
        this.x = this.inicialX;
        this.y = CHAO;
        this.vy = 0;
        this.vida = 100;
        this.vivo = true;
    }
}

function colisao(a, b) {
    return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
    );
}

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

const p1 = new Lutador(250, "cyan", { esq: "a", dir: "d", pulo: "w", ataque: "f" }, 1);
const p2 = new Lutador(650, "red", { esq: "ArrowLeft", dir: "ArrowRight", pulo: "ArrowUp", ataque: "Enter" }, -1);

function desenharBarras() {
    ctx.fillStyle = "red";
    ctx.fillRect(50, 20, p1.vida * 2, 15);
    ctx.fillRect(900 - 50 - p2.vida * 2, 20, p2.vida * 2, 15);
}

function desenharMensagemFim() {
    ctx.fillStyle = "white";
    ctx.font = "30px Arial";
    ctx.textAlign = "center";
    ctx.fillText("FIM DE JOGO", canvas.width / 2, 180);
    ctx.font = "18px Arial";
    ctx.fillText("Pressione R para recomeçar", canvas.width / 2, 220);
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // FUNDO
const fundoAltura = 180; // altura visível do pinico
const fundoY = CHAO - 40; // posição nos pés dos lutadores

ctx.drawImage(
    fundo,
    0,
    fundoY,
    canvas.width,
    fundoAltura
);



    desenharBarras();

    p1.mover(keys);
    p1.pular(keys);
    p1.atacar(keys, p2);
    p1.aplicarFisica();
    p1.desenhar();

    p2.mover(keys);
    p2.pular(keys);
    p2.atacar(keys, p1);
    p2.aplicarFisica();
    p2.desenhar();

    if (!p1.vivo || !p2.vivo) {
        desenharMensagemFim();
        if (keys["r"] || keys["R"]) {
            p1.reset();
            p2.reset();
        }
    }

    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
