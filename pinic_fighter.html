<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pinico Fighter</title>

<style>
    body {
        margin: 0;
        background: #111;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        font-family: Arial;
        color: white;
    }

    .logo img {
        max-width: 240px;
        margin-bottom: 10px;
    }

    canvas {
        border: 3px solid #0f0;
        background: #222;
    }
</style>
</head>

<body>

<div class="logo">
    <img src="imagens/logo.png">
</div>

<canvas id="game" width="900" height="400"></canvas>

<!-- FIREBASE (COMPAT) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyDy_gqNrFR7KmMonXp7KfgRc15UVj0g3Nw",
  authDomain: "pinico-fighter.firebaseapp.com",
  databaseURL: "https://pinico-fighter-default-rtdb.firebaseio.com",
  projectId: "pinico-fighter",
  storageBucket: "pinico-fighter.firebasestorage.app",
  messagingSenderId: "152199667347",
  appId: "1:152199667347:web:9c74188c88bdee8633f766"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

/* ================= DEFINIÇÃO DE PLAYER ================= */
const meuPlayer = prompt("Digite 1 para Player 1 ou 2 para Player 2");
const meuId = meuPlayer === "1" ? "p1" : "p2";
const inimigoId = meuId === "p1" ? "p2" : "p1";

/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const fundo = new Image();
fundo.src = "imagens/fundo.png";

const GRAVIDADE = 0.8;
const CHAO = 320;
const LIMITE_ESQ = 40;
const LIMITE_DIR = canvas.width - 40;

/* ================= LUTADOR ================= */
class Lutador {
    constructor(x, cor, controles, direcao) {
        this.x = x;
        this.y = CHAO;
        this.vy = 0;
        this.cor = cor;
        this.altura = 60;
        this.velocidade = 4;
        this.direcao = direcao;
        this.pulando = false;
        this.atacando = false;
        this.vida = 100;
        this.vivo = true;
        this.controles = controles;
    }

    mover(keys) {
        if (!this.vivo) return;
        if (keys[this.controles.esq]) {
            this.x -= this.velocidade;
            this.direcao = -1;
        }
        if (keys[this.controles.dir]) {
            this.x += this.velocidade;
            this.direcao = 1;
        }
        this.x = Math.max(LIMITE_ESQ, Math.min(LIMITE_DIR, this.x));
    }

    pular(keys) {
        if (keys[this.controles.pulo] && !this.pulando) {
            this.vy = -15;
            this.pulando = true;
        }
    }

    aplicarFisica() {
        this.y += this.vy;
        this.vy += GRAVIDADE;
        if (this.y >= CHAO) {
            this.y = CHAO;
            this.vy = 0;
            this.pulando = false;
        }
    }

    desenhar() {
        ctx.strokeStyle = this.cor;
        ctx.lineWidth = 4;

        if (!this.vivo) {
            ctx.beginPath();
            ctx.moveTo(this.x - 30, this.y);
            ctx.lineTo(this.x + 30, this.y);
            ctx.stroke();
            return;
        }

        const corpoY = this.y - this.altura;

        ctx.beginPath();
        ctx.moveTo(this.x, corpoY);
        ctx.lineTo(this.x, this.y);
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(this.x, corpoY - 10, 10, 0, Math.PI * 2);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(this.x, corpoY + 20);
        ctx.lineTo(this.x + this.direcao * 20, corpoY + 30);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(this.x, corpoY + 20);
        ctx.lineTo(this.x - this.direcao * 10, corpoY + 30);
        ctx.stroke();
    }
}

/* ================= CONTROLES ================= */
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/* ================= JOGADORES ================= */
const p1 = new Lutador(250, "cyan", { esq: "a", dir: "d", pulo: "w" }, 1);
const p2 = new Lutador(650, "red", { esq: "ArrowLeft", dir: "ArrowRight", pulo: "ArrowUp" }, -1);

/* ================= FIREBASE SYNC ================= */
function enviarEstado(j) {
    database.ref("jogo/" + meuId).set({
        x: j.x,
        y: j.y,
        vida: j.vida,
        direcao: j.direcao,
        vivo: j.vivo
    });
}

database.ref("jogo/" + inimigoId).on("value", snap => {
    const d = snap.val();
    if (!d) return;
    const inimigo = inimigoId === "p1" ? p1 : p2;
    inimigo.x = d.x;
    inimigo.y = d.y;
    inimigo.vida = d.vida;
    inimigo.direcao = d.direcao;
    inimigo.vivo = d.vivo;
});

/* ================= LOOP ================= */
function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Fundo (nos pés)
    ctx.drawImage(fundo, 0, CHAO - 40, canvas.width, 180);

    if (meuId === "p1") {
        p1.mover(keys);
        p1.pular(keys);
        p1.aplicarFisica();
        enviarEstado(p1);
    }

    if (meuId === "p2") {
        p2.mover(keys);
        p2.pular(keys);
        p2.aplicarFisica();
        enviarEstado(p2);
    }

    p1.desenhar();
    p2.desenhar();

    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
